<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="http://mia-grotesk.s3.amazonaws.com/index.css" type="text/css" media="screen" />
</head>
<body style="background-color:black;color:white;margin:0px;width:1920px; height: 1080px; overflow: hidden;">

<script>
var name = "__NAME"
var imageString = "__IMAGES__"
var caption = `__CAPTION__`

var images = imageString.split(" ").map(function(img) {
  return img
})


var image = document.createElement('img')
image.src = './'+images[0]

document.body.appendChild(image)

if(caption !== "") {
  var text = document.createElement('div')
  text.classList.add('caption')
  var captionJson;
  try {
    captionJson = JSON.parse(caption)
    fancyCaption()
  } catch(test) {
    captionJson = false
    text.innerHTML = caption
  }

  if(captionJson && Object.values(captionJson)[0].id) {
    // temporarily, don't caption artworks
    // (because the images have the gallery hardcoded
    // and re-making them all is hard. Continue to use the
    // location info to skip "Not on View" objects)
  } else {
    var gradient = document.createElement('div')
    gradient.classList.add('gradient-overlay')

    document.body.appendChild(text)
    document.body.appendChild(gradient)
  }
}

var transition = setInterval(function() {
  var relativeImageName = image.src.match(/[^\/]+\.jpg$/)[0]
  var currentIndex = images.indexOf(relativeImageName)
  var nextIndex = (currentIndex+1) % (images.length-1)

  if(captionJson) {
    var info = captionJson[images[nextIndex]]
    console.info(info)
    // skip to the next if:
    // an object is not on view per TMS
    // or an exhibition has ended per the calendar
    while(info.location == 'Not on View' || info.dateTo && new Date(info.dateTo) < new Date()) {
      images.splice(nextIndex, 1)
      console.info('not on view or ended, skipping', info)
      info = captionJson[images[nextIndex]]
    }
  }

  var nextImage = images[nextIndex]
  image.src = './'+nextImage
  if(captionJson) image.onload = fancyCaption
}, 11000)

function fancyCaption() {
  var relativeImageName = image.src.match(/[^\/]+\.jpg$/)[0]
  var info = captionJson[relativeImageName]
  if(info.id) return
  text.innerHTML = `<h1>${info.title}</h1> <h2>${info.location}</h2>`
}
</script>

<style type="text/css">
img {
  position: absolute;
  top: 0;
}

.gradient-overlay {
  position: absolute;
  z-index: 1;
  width: 1920px;
  height: 1080px;
  background: radial-gradient(at bottom right,
    rgba(0, 0, 0, 0.5),
    rgba(0, 0, 0, 0.25),
    rgba(0, 0, 0, 0.05),
    rgba(0, 0, 0, 0));
}

.caption {
  font-family: MiaGrotesk-Light;
  position: absolute;
  bottom: 4em;
  right: 6em;
  max-width: 34%;
  line-height: 3.7em;
  text-align: right;
}

.caption {
  z-index: 2;
}
.caption > * {
  font-size: 45px;
  margin: 0
}

.caption h1, .caption strong {
  font-family: MiaGrotesk-Bold;
}
</style>
</body>
</html>

